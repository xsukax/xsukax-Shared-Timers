<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>xsukax Shared Timers</title>
    <style>
        *{margin:0;padding:0;box-sizing:border-box;}
        body{background:#0a0a0a;color:#00ff00;font-family:'Courier New',monospace;font-size:14px;line-height:1.4;min-height:100vh;}
        .container{max-width:900px;margin:0 auto;padding:20px;}
        .header{text-align:center;margin-bottom:30px;border-bottom:1px solid #333;padding-bottom:20px;}
        .header h1{color:#00ff00;font-size:28px;margin-bottom:5px;text-shadow:0 0 10px rgba(0,255,0,0.3);}
        .header p{color:#666;font-size:12px;}
        .terminal-box{background:#111;border:1px solid #333;border-radius:4px;padding:25px;margin:20px 0;box-shadow:0 0 20px rgba(0,255,0,0.1);}
        .form-group{margin-bottom:20px;}
        .form-group label{display:block;color:#00ff00;margin-bottom:8px;font-size:12px;text-transform:uppercase;letter-spacing:1px;}
        .form-row{display:flex;gap:15px;flex-wrap:wrap;}
        .form-row .form-group{flex:1;min-width:80px;}
        input[type="number"],input[type="text"]{background:#000;border:1px solid #333;color:#00ff00;padding:12px;font-family:inherit;font-size:14px;width:100%;border-radius:3px;transition:all 0.3s;}
        input[type="number"]:focus,input[type="text"]:focus{outline:none;border-color:#00ff00;box-shadow:0 0 10px rgba(0,255,0,0.2);}
        .btn{background:#003300;border:1px solid #00ff00;color:#00ff00;padding:12px 24px;font-family:inherit;font-size:14px;cursor:pointer;margin:5px;transition:all 0.3s;border-radius:3px;text-decoration:none;display:inline-block;}
        .btn:hover{background:#00ff00;color:#000;transform:translateY(-1px);box-shadow:0 4px 15px rgba(0,255,0,0.3);}
        .btn:active{transform:translateY(0);}
        .timer-display{text-align:center;font-size:64px;color:#00ff00;margin:40px 0;font-weight:bold;letter-spacing:4px;text-shadow:0 0 20px rgba(0,255,0,0.5);font-variant-numeric:tabular-nums;}
        .timer-info{color:#888;font-size:13px;text-align:center;margin-bottom:30px;line-height:1.6;}
        .timer-info strong{color:#00ff00;}
        .timer-info code{display:block;margin-top:5px;padding:10px;background:#000;border:1px solid #333;border-radius:3px;word-break:break-all;white-space:pre-wrap;max-width:100%;overflow-wrap:break-word;}
        .timer-expired{color:#ff0000;animation:pulse 1.5s infinite;}
        @keyframes pulse{0%,100%{opacity:1;}50%{opacity:0.4;}}
        .recent-timers{margin-top:40px;}
        .recent-timers h3{color:#00ff00;margin-bottom:20px;font-size:18px;text-transform:uppercase;letter-spacing:1px;}
        .timer-item{background:#111;border:1px solid #333;padding:15px;margin-bottom:15px;display:flex;justify-content:space-between;align-items:center;border-radius:3px;transition:all 0.3s;}
        .timer-item:hover{border-color:#00ff00;box-shadow:0 0 10px rgba(0,255,0,0.1);}
        .timer-item a{color:#00ff00;text-decoration:none;font-weight:bold;}
        .timer-item a:hover{text-decoration:underline;}
        .timer-status{font-size:12px;color:#666;margin-top:5px;}
        .timer-actions{display:flex;gap:10px;align-items:center;}
        .timer-actions button{padding:8px 12px;font-size:12px;margin:0;}
        .message{padding:15px;margin:20px 0;text-align:center;border-radius:3px;}
        .message.error{background:#330000;border:1px solid #ff0000;color:#ff0000;}
        .message.success{background:#003300;border:1px solid #00ff00;color:#00ff00;}
        .modal{display:none;position:fixed;z-index:1000;left:0;top:0;width:100%;height:100%;background:rgba(0,0,0,0.9);}
        .modal-content{background:#111;margin:10% auto;padding:30px;border:1px solid #00ff00;width:400px;border-radius:5px;text-align:center;box-shadow:0 0 30px rgba(0,255,0,0.3);}
        .modal-content h3{color:#00ff00;margin-bottom:20px;font-size:20px;}
        .modal-content p{color:#ccc;margin-bottom:25px;line-height:1.5;word-break:break-word;}
        @media (max-width:768px){.form-row{flex-direction:column;}.timer-display{font-size:48px;}.container{padding:15px;}.modal-content{width:90%;margin:20% auto;}}
        @media (max-width:480px){.timer-display{font-size:36px;}.header h1{font-size:24px;}.timer-item{flex-direction:column;align-items:flex-start;}.timer-actions{margin-top:10px;}}
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>xsukax Shared Timers</h1>
            <p>Create persistent timers with unique shareable URLs ‚Ä¢ All times displayed in your local timezone</p>
        </div>

        <div id="message-container"></div>

        <div id="timer-view" class="terminal-box" style="display:none;">
            <div class="timer-info">
                <strong id="timer-title">Timer</strong>
                <br><span id="timer-start-time">Started: --</span>
                <br>Duration: <span id="timer-duration">--</span>
                <br>Share this timer: <code id="timer-url">--</code>
            </div>
            
            <div id="timer-display" class="timer-display">
                --:--:--
            </div>
            
            <div style="text-align: center;">
                <button class="btn" onclick="goHome()">‚Üê Create New Timer</button>
                <button class="btn" onclick="copyURL()">üìã Copy URL</button>
                <button class="btn" onclick="toggleFullscreen()">‚õ∂ Fullscreen</button>
            </div>
        </div>

        <div id="create-view" class="terminal-box">
            <h2 style="color: #00ff00; margin-bottom: 25px; text-transform: uppercase; letter-spacing: 1px;">Create New Timer</h2>
            
            <form id="timerForm" onsubmit="createTimer(event)">
                <div class="form-group">
                    <label for="title">Timer Title</label>
                    <input type="text" id="title" name="title" placeholder="My Timer" maxlength="100">
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="days">Days</label>
                        <input type="number" id="days" name="days" min="0" max="365" value="0">
                    </div>
                    <div class="form-group">
                        <label for="hours">Hours</label>
                        <input type="number" id="hours" name="hours" min="0" max="23" value="0">
                    </div>
                    <div class="form-group">
                        <label for="minutes">Minutes</label>
                        <input type="number" id="minutes" name="minutes" min="0" max="59" value="5">
                    </div>
                    <div class="form-group">
                        <label for="seconds">Seconds</label>
                        <input type="number" id="seconds" name="seconds" min="0" max="59" value="0">
                    </div>
                </div>
                
                <button type="submit" class="btn" style="width: 100%; margin-top: 25px; padding: 15px;">
                    üöÄ Start Timer
                </button>
            </form>
            
            <div style="margin-top: 20px; text-align: center; color: #666; font-size: 12px;">
                Tip: Timer will start immediately and run continuously. You'll get a unique URL to share.
            </div>
        </div>

        <div id="recent-timers" class="recent-timers" style="display:none;">
            <h3>Your Recent Timers</h3>
            <div id="recent-timers-list"></div>
        </div>
    </div>

    <!-- Modal -->
    <div id="modal" class="modal" onclick="closeModalOnOutside(event)">
        <div class="modal-content">
            <h3 id="modal-title">Notification</h3>
            <p id="modal-message">Message</p>
            <button class="btn" onclick="closeModal()">Close</button>
        </div>
    </div>

    <script>
        // Timer data structure
        let currentTimer = null;
        let timerInterval = null;

        // Local storage key for recent timers
        const STORAGE_KEY = 'xsukax_recent_timers';

        // Encoding/Decoding functions
        function encodeTimerData(timerData) {
            const json = JSON.stringify(timerData);
            return btoa(encodeURIComponent(json));
        }

        function decodeTimerData(encoded) {
            try {
                const json = decodeURIComponent(atob(encoded));
                return JSON.parse(json);
            } catch (e) {
                return null;
            }
        }

        // URL handling
        function getTimerFromURL() {
            const params = new URLSearchParams(window.location.search);
            const encoded = params.get('t');
            if (encoded) {
                return decodeTimerData(encoded);
            }
            return null;
        }

        function createTimerURL(timerData) {
            const encoded = encodeTimerData(timerData);
            return window.location.origin + window.location.pathname + '?t=' + encoded;
        }

        // Local storage functions
        function getRecentTimers() {
            try {
                const stored = localStorage.getItem(STORAGE_KEY);
                return stored ? JSON.parse(stored) : [];
            } catch (e) {
                return [];
            }
        }

        function saveRecentTimer(timerData) {
            try {
                let recent = getRecentTimers();
                recent.unshift(timerData);
                // Keep only last 15 timers
                recent = recent.slice(0, 15);
                localStorage.setItem(STORAGE_KEY, JSON.stringify(recent));
            } catch (e) {
                console.error('Failed to save timer to local storage', e);
            }
        }

        function deleteRecentTimer(index) {
            try {
                let recent = getRecentTimers();
                recent.splice(index, 1);
                localStorage.setItem(STORAGE_KEY, JSON.stringify(recent));
                renderRecentTimers();
            } catch (e) {
                console.error('Failed to delete timer', e);
            }
        }

        // Time formatting functions
        function formatLocalTime(timestamp, format = 'full') {
            const date = new Date(timestamp * 1000);
            
            if (format === 'short') {
                return date.toLocaleDateString([], {
                    month: 'short', 
                    day: 'numeric', 
                    year: 'numeric'
                }) + ' ' + date.toLocaleTimeString([], {
                    hour: '2-digit', 
                    minute: '2-digit'
                });
            }
            
            return date.toLocaleDateString([], {
                weekday: 'short',
                year: 'numeric',
                month: 'short',
                day: 'numeric'
            }) + ' ' + date.toLocaleTimeString([], {
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
        }
        
        function formatDuration(totalSeconds) {
            const days = Math.floor(totalSeconds / 86400);
            const hours = Math.floor((totalSeconds % 86400) / 3600);
            const minutes = Math.floor((totalSeconds % 3600) / 60);
            const seconds = totalSeconds % 60;
            
            let parts = [];
            if (days > 0) parts.push(days + 'd');
            if (hours > 0) parts.push(hours + 'h');
            if (minutes > 0) parts.push(minutes + 'm');
            if (seconds > 0 && days === 0) parts.push(seconds + 's');
            
            return parts.length > 0 ? parts.join(' ') : '0s';
        }
        
        function formatCountdown(seconds) {
            const h = Math.floor(seconds / 3600);
            const m = Math.floor((seconds % 3600) / 60);
            const s = seconds % 60;
            
            return String(h).padStart(2, '0') + ':' +
                   String(m).padStart(2, '0') + ':' +
                   String(s).padStart(2, '0');
        }

        // Timer functions
        function createTimer(event) {
            event.preventDefault();
            
            const title = document.getElementById('title').value.trim() || 'Timer';
            const days = parseInt(document.getElementById('days').value) || 0;
            const hours = parseInt(document.getElementById('hours').value) || 0;
            const minutes = parseInt(document.getElementById('minutes').value) || 0;
            const seconds = parseInt(document.getElementById('seconds').value) || 0;
            
            const totalSeconds = (days * 86400) + (hours * 3600) + (minutes * 60) + seconds;
            
            if (totalSeconds <= 0) {
                showModal('‚ö† Invalid Duration', 'Timer duration must be greater than 0. Please enter at least 1 second.');
                return;
            }
            
            const maxSeconds = 365 * 24 * 3600;
            if (totalSeconds > maxSeconds) {
                showModal('‚ö† Duration Too Long', 'Maximum timer duration is 365 days.');
                return;
            }
            
            const timerData = {
                title: title,
                start: Math.floor(Date.now() / 1000),
                duration: totalSeconds,
                created: Math.floor(Date.now() / 1000)
            };
            
            saveRecentTimer(timerData);
            
            const url = createTimerURL(timerData);
            window.history.pushState({}, '', url);
            loadTimer(timerData);
        }

        function loadTimer(timerData) {
            currentTimer = timerData;
            
            document.getElementById('create-view').style.display = 'none';
            document.getElementById('timer-view').style.display = 'block';
            
            document.getElementById('timer-title').textContent = timerData.title;
            document.getElementById('timer-start-time').textContent = 'Started: ' + formatLocalTime(timerData.start);
            document.getElementById('timer-duration').textContent = formatDuration(timerData.duration);
            document.getElementById('timer-url').textContent = window.location.href;
            
            updateTimerDisplay();
            
            if (timerInterval) {
                clearInterval(timerInterval);
            }
            timerInterval = setInterval(updateTimerDisplay, 1000);
        }

        function updateTimerDisplay() {
            if (!currentTimer) return;
            
            const now = Math.floor(Date.now() / 1000);
            const elapsed = now - currentTimer.start;
            const remaining = Math.max(0, currentTimer.duration - elapsed);
            
            const display = document.getElementById('timer-display');
            
            if (remaining <= 0) {
                display.textContent = '00:00:00';
                display.classList.add('timer-expired');
                if (!display.hasAttribute('data-notified')) {
                    showModal('üéâ Timer Completed!', 'Your timer has finished running.');
                    display.setAttribute('data-notified', 'true');
                }
                if (timerInterval) {
                    clearInterval(timerInterval);
                }
                return;
            }
            
            display.textContent = formatCountdown(remaining);
        }

        function goHome() {
            if (timerInterval) {
                clearInterval(timerInterval);
            }
            currentTimer = null;
            
            window.history.pushState({}, '', window.location.pathname);
            
            document.getElementById('timer-view').style.display = 'none';
            document.getElementById('create-view').style.display = 'block';
            
            renderRecentTimers();
        }

        // Recent timers
        function renderRecentTimers() {
            const recent = getRecentTimers();
            const container = document.getElementById('recent-timers-list');
            const section = document.getElementById('recent-timers');
            
            if (recent.length === 0) {
                section.style.display = 'none';
                return;
            }
            
            section.style.display = 'block';
            container.innerHTML = '';
            
            recent.forEach((timer, index) => {
                const now = Math.floor(Date.now() / 1000);
                const elapsed = now - timer.start;
                const remaining = Math.max(0, timer.duration - elapsed);
                
                let status = '';
                let statusColor = '';
                
                if (remaining <= 0) {
                    status = 'Completed';
                    statusColor = '#ff6666';
                } else {
                    status = 'Running (' + formatCountdown(remaining) + ' left)';
                    statusColor = '#00ff00';
                }
                
                const timerURL = createTimerURL(timer);
                
                const item = document.createElement('div');
                item.className = 'timer-item';
                item.innerHTML = `
                    <div>
                        <a href="${timerURL}">
                            ${escapeHtml(timer.title)}
                        </a>
                        <div class="timer-status">
                            Created: ${formatLocalTime(timer.created, 'short')}
                            | Duration: ${formatDuration(timer.duration)}
                            | Status: <span style="color: ${statusColor}">${status}</span>
                        </div>
                    </div>
                    <div class="timer-actions">
                        <button class="btn" onclick="openTimer('${encodeTimerData(timer)}')">Open</button>
                        <button class="btn" onclick="deleteTimer(${index})">Delete</button>
                    </div>
                `;
                container.appendChild(item);
            });
        }

        function openTimer(encoded) {
            const timer = decodeTimerData(encoded);
            if (timer) {
                const url = createTimerURL(timer);
                window.location.href = url;
            }
        }

        function deleteTimer(index) {
            deleteRecentTimer(index);
        }

        // Utility functions
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function showMessage(message, isError = false) {
            const container = document.getElementById('message-container');
            container.innerHTML = `
                <div class="message ${isError ? 'error' : 'success'}">
                    ${escapeHtml(message)}
                </div>
            `;
            
            setTimeout(() => {
                container.innerHTML = '';
            }, 5000);
        }

        function showModal(title, message) {
            document.getElementById('modal-title').textContent = title;
            document.getElementById('modal-message').textContent = message;
            document.getElementById('modal').style.display = 'block';
        }
        
        function closeModal() {
            document.getElementById('modal').style.display = 'none';
        }

        function closeModalOnOutside(event) {
            if (event.target === document.getElementById('modal')) {
                closeModal();
            }
        }
        
        function copyURL() {
            const url = window.location.href;
            
            if (navigator.clipboard) {
                navigator.clipboard.writeText(url).then(() => {
                    showModal('üìã URL Copied!', 'Timer URL has been copied to clipboard.');
                }).catch(() => {
                    fallbackCopy(url);
                });
            } else {
                fallbackCopy(url);
            }
        }
        
        function fallbackCopy(text) {
            const textArea = document.createElement('textarea');
            textArea.value = text;
            textArea.style.position = 'fixed';
            textArea.style.opacity = '0';
            document.body.appendChild(textArea);
            textArea.select();
            
            try {
                document.execCommand('copy');
                showModal('üìã URL Copied!', 'Timer URL has been copied to clipboard.');
            } catch (err) {
                showModal('üìã Copy Failed', 'Unable to copy URL. Please copy manually from the URL bar.');
            }
            
            document.body.removeChild(textArea);
        }
        
        function toggleFullscreen() {
            const timerDisplay = document.getElementById('timer-display');
            if (!timerDisplay) return;
            
            if (!document.fullscreenElement) {
                timerDisplay.requestFullscreen().catch(err => {
                    showModal('‚õ∂ Fullscreen', 'Fullscreen not supported or blocked by browser.');
                });
            } else {
                document.exitFullscreen();
            }
        }

        // Initialization
        function init() {
            const timerData = getTimerFromURL();
            
            if (timerData) {
                loadTimer(timerData);
            } else {
                renderRecentTimers();
            }
            
            // Keyboard shortcuts
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    closeModal();
                } else if (e.key === 'c' && e.ctrlKey && currentTimer) {
                    e.preventDefault();
                    copyURL();
                } else if (e.key === 'F11' && currentTimer) {
                    e.preventDefault();
                    toggleFullscreen();
                }
            });

            // Handle browser back/forward
            window.addEventListener('popstate', function() {
                const timerData = getTimerFromURL();
                if (timerData) {
                    loadTimer(timerData);
                } else {
                    goHome();
                }
            });
        }

        // Start the app
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
